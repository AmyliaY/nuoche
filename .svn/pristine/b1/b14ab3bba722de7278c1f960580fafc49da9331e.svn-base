/* @preserve
 * gcoord 0.1.0-alpha, a JS library for transform geographical coordinates.
 * Copyright (c) 2018 Jiulong Hu <me@hujiulong.com>
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r(t.gcoord={})}(this,function(t){"use strict";var r="WGS84",e="GCJ02",n="BD09",o="WebMercator";function i(t,r){if(t)throw new Error(r)}function a(t){return!isNaN(t)&&null!==t&&!u(t)}function u(t){return!!t&&"[object Array]"===Object.prototype.toString.call(t)}function f(){var t=arguments,r=t.length-1;return function(){for(var e=r,n=t[r].apply(this,arguments);e--;)n=t[e].call(this,n);return n}}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c=function(){return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,r){var e=[],n=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(e.push(a.value),!r||e.length!==r);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&u.return&&u.return()}finally{if(o)throw i}}return e}(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=Math.sin,y=Math.cos,v=Math.sqrt,h=Math.abs,d=Math.PI,b=6378245,g=.006693421622965823;function p(t){var r=c(t,2),e=r[0],n=r[1];if(!M(e,n))return[e,n];for(var o=e,i=n,a=S([o,i]),u=a[0]-e,f=a[1]-n;h(u)>1e-6||h(f)>1e-6;)u=(a=S([o-=u,i-=f]))[0]-e,f=a[1]-n;return[o,i]}function S(t){var r=c(t,2),e=r[0],n=r[1];if(!M(e,n))return[e,n];var o,i,a,u,f,l,p,S,m,G,P,C,W,B=(W=300+(P=(o=e)-105)+2*(C=(i=n)-35)+.1*P*P+.1*P*C+.1*v(h(P)),W+=2*(20*s(6*P*d)+20*s(2*P*d))/3,W+=2*(20*s(P*d)+40*s(P/3*d))/3,a=W+=2*(150*s(P/12*d)+300*s(P/30*d))/3,G=2*(S=o-105)-100+3*(m=i-35)+.2*m*m+.1*S*m+.2*v(h(S)),G+=2*(20*s(6*S*d)+20*s(2*S*d))/3,G+=2*(20*s(m*d)+40*s(m/3*d))/3,u=G+=2*(160*s(m/12*d)+320*s(m*d/30))/3,l=s(f=i/180*d),p=v(l=1-g*l*l),[a=180*a/(b/p*y(f)*d),u=180*u/(b*(1-g)/(l*p)*d)]);return[e+B[0],n+B[1]]}function M(t,r){return i(void 0===t||void 0===r,"lon and lat are required"),i(!a(t)||!a(r),"lon and lat must be numbers"),t>=72.004&&t<=137.8347&&r>=.8293&&r<=55.8271}var m=Math.sin,G=Math.cos,P=Math.atan2,C=Math.sqrt,W=3e3*Math.PI/180;function B(t){var r=c(t,2),e=r[0]-.0065,n=r[1]-.006,o=C(e*e+n*n)-2e-5*m(n*W),i=P(n,e)-3e-6*G(e*W);return[o*G(i),o*m(i)]}function E(t){var r=c(t,2),e=r[0],n=r[1],o=C(e*e+n*n)+2e-5*m(n*W),i=P(n,e)+3e-6*G(e*W);return[o*G(i)+.0065,o*m(i)+.006]}var j=180/Math.PI,w=Math.PI/180,D=6378137,J=20037508.342789244;function k(t){return[t[0]*j/D,(.5*Math.PI-2*Math.atan(Math.exp(-t[1]/D)))*j]}function I(t){var r=Math.abs(t[0])<=180?t[0]:t[0]-360*(t[0]<0?-1:1),e=[D*r*w,D*Math.log(Math.tan(.25*Math.PI+.5*t[1]*w))];return e[0]>J&&(e[0]=J),e[0]<-J&&(e[0]=-J),e[1]>J&&(e[1]=J),e[1]<-J&&(e[1]=-J),e}var q={to:{GCJ02:S,BD09:f(E,S),EPSG3857:I}},O={to:{WGS84:p,BD09:E,EPSG3857:f(I,p)}},x={to:{WGS84:f(p,B),GCJ02:B,EPSG3857:f(I,p,B)}},A={to:{WGS84:k,GCJ02:f(S,k),BD09:f(E,S,k)}},L=(Object.freeze||Object)({WGS84:q,GCJ02:O,BD09:x,EPSG3857:A});t.transform=function(t,r,e){i(!t,"input is required"),i(!r,"fromCRS is required"),i(!e,"toCRS is required");var n=L[r];i(!n,"fromCRS is invalid");var o=n.to[e];i(!o,"toCRS is invalid");var f=void 0===t?"undefined":l(t);i("string"!==f&&"object"!==f,"input must be an geojson or an array of position"),"string"===f&&(t=JSON.parse(t));var c=!1;u(t)&&(i(t.length<2,"position must be at 2 numbers long"),i(!a(t[0])||!a(t[1]),"position must contain numbers"),c=!0);var s=null,y=o;return c?s=y(t):(function t(r,e,n){if(null!==r)for(var o=void 0,i=void 0,a=void 0,u=void 0,f=void 0,l=void 0,c=void 0,s=0,y=0,v=void 0,h=r.type,d="FeatureCollection"===h,b="Feature"===h,g=d?r.features.length:1,p=0;p<g;p++){f=(v=!!(c=d?r.features[p].geometry:b?r.geometry:r)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var S=0;S<f;S++){var M=0,m=0;if(null!==(u=v?c.geometries[S]:c)){l=u.coordinates;var G=u.type;switch(s=!n||"Polygon"!==G&&"MultiPolygon"!==G?0:1,G){case null:break;case"Point":if(!1===e(l,y,p,M,m))return!1;y++,M++;break;case"LineString":case"MultiPoint":for(o=0;o<l.length;o++){if(!1===e(l[o],y,p,M,m))return!1;y++,"MultiPoint"===G&&M++}"LineString"===G&&M++;break;case"Polygon":case"MultiLineString":for(o=0;o<l.length;o++){for(i=0;i<l[o].length-s;i++){if(!1===e(l[o][i],y,p,M,m))return!1;y++}"MultiLineString"===G&&M++,"Polygon"===G&&m++}"Polygon"===G&&M++;break;case"MultiPolygon":for(o=0;o<l.length;o++){for(m=0,i=0;i<l[o].length;i++){for(a=0;a<l[o][i].length-s;a++){if(!1===e(l[o][i][a],y,p,M,m))return!1;y++}m++}M++}break;case"GeometryCollection":for(o=0;o<u.geometries.length;o++)if(!1===t(u.geometries[o],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(t,function(t){var r=y(t);t[0]=r[0],t[1]=r[1]}),s=t),s},t.WGS84=r,t.WGS1984="WGS84",t.GCJ02=e,t.BD09=n,t.WebMercator=o,t.EPSG4326="WGS84",t.EPSG3857="WebMercator",t.EPSG900913="WebMercator",t.Baidu="BD09",t.BMap="BD09",t.AMap="GCJ02",Object.defineProperty(t,"__esModule",{value:!0})});